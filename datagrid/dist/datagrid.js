define("value/datagrid/1.0.0/datagrid",["$","gallery/backbone/1.1.0/backbone","gallery/underscore/1.5.2/underscore","value/datasource/1.0.0/datasource","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events","value/base/1.0.0/base","arale/templatable/0.9.2/templatable","gallery/handlebars/1.0.2/handlebars","arale/widget/1.1.1/widget","value/form-text/1.0.0/form-text","value/form/1.0.0/form-widget","gallery/handlebars/1.0.2/runtime","./data-grid-text.handlebars","value/form-select/1.0.0/form-select","jquery/select2/3.4.5/select2-zh-cn","./data-grid-select.handlebars","value/form-buttons/1.0.0/form-buttons","./data-grid-buttons.handlebars","value/form-radio/1.0.0/form-radio","value/form-checkbox/1.0.0/form-checkbox","./grid-item/grid-item","./grid-item/grid-item.handlebars","value/paginator/1.0.0/paginator","./data-grid.handlebars"],function(a){"use strict";var b,c=a("$"),d=a("gallery/backbone/1.1.0/backbone").history,e=a("value/datasource/1.0.0/datasource"),f=a("value/base/1.0.0/base"),g=a("value/form-text/1.0.0/form-text"),h=a("./data-grid-text.handlebars"),i=a("value/form-select/1.0.0/form-select"),j=a("./data-grid-select.handlebars"),k=a("value/form-buttons/1.0.0/form-buttons"),l=a("./data-grid-buttons.handlebars"),m=a("value/form-radio/1.0.0/form-radio"),n=a("value/form-checkbox/1.0.0/form-checkbox"),o=a("./grid-item/grid-item"),p=a("value/paginator/1.0.0/paginator"),q=a("./data-grid.handlebars"),r={},s=function(){return d.fragment},t={},u=f.extend({attrs:{parentNode:null,template:q,model:{},url:"",urlIds:[],queryParams:{},hasPaginator:!0,paginatorCfg:{targetPage:1,pageSize:15,symbolMapping:{previous:'<span class="glyphicon glyphicon-arrow-left"></span> 上一页',next:'下一页 <span class="glyphicon glyphicon-arrow-right"></span>'}},tableCfg:{cols:[]}},paginator:null,tableBtns:null,groupBtns:null,$searchGroup:null,$filterGroup:null,formWidgets:{},searchDOM:null,events:{"keyup input.keywords":function(a){13===a.which&&this.doSearch()},"click input:checkbox,input:radio":function(){this.doSearch()},"click .top-operation .btn-group a":function(a){var b=this,d=c(a.currentTarget),e=d.data("btnkey"),f=this.groupBtns[e];f&&f.action&&f.action.call(b,d)}},initAttrs:function(a,b){u.superclass.initAttrs.call(this,a,b),r[this.cid]=this,this.setModel(),this._initDataSource(),this.setSearchDataStorage()},setSearchDataStorage:function(){var a=s();b=t[a]||{}},registerWidget:function(a,b){b.set("dataGrid",this),this.formWidgets[a]=b},getWidget:function(a){return this.formWidgets[a]},setModel:function(){var a={cid:this.cid,topOperation:this.get("topOperation"),tableCfg:this.get("tableCfg")};this.set("model",a)},setup:function(){this.$searchGroup=this.$("div.search-group"),this.$filterGroup=this.$("div.filter-group");var a=this.get("topOperation");a&&(this._initTopOperation(),this._convertGroupBtns()),this._convertTableBtns(),this.initPaginator(),u.superclass.setup.call(this)},initPaginator:function(){var a=this,b=this.get("hasPaginator");b&&(this.paginator=new p({parentNode:this.$("div.paginator-wrapper"),pageClick:function(b){a.doSearch(b)}}))},_convertTableBtns:function(){var a=this.get("tableCfg");a.operators&&(this.tableBtns=a.operators.btnMap)},_convertGroupBtns:function(){var a=this.get("topOperation"),b=a.btnsGroup,c={};b&&b.forEach(function(a){a.btnkey&&(c[a.btnkey]=a)}),this.groupBtns=c},_initTopOperation:function(){var a=this.get("topOperation"),b=a.searchGroup,c=a.filtersGroup;b&&this._initSearchGroup(b),c&&this._initFiltersGroup(c)},_initSearchGroup:function(a){var b=this;b.insertSearchText(a),b.insertSearchSelect(a),b.insertSeachBtn(a)},insertSearchText:function(a){var c=this;if(a.input){var d=a.input.name,e=decodeURIComponent(b[d]||""),f=new g({template:h,name:d,value:e,nodeData:a.input.nodeData,needEncode:!0});c.insertSearchWidget(d,f)}},insertSearchSelect:function(a){var d=this;if(a.select){var e=a.select.name,f=new i(c.extend(!0,a.select,{selected:b[e],addNullChoice:a.select.addNullChoice,template:j}));d.insertSearchWidget(e,f)}},insertSeachBtn:function(a){var b=this;if(a.searchBtn){var c="data-grid-btn",d=new k({template:l,btns:[{btnkey:c,text:"搜索",type:"default",handler:function(){b.doSearch()}}]});b.insertSearchWidget(c,d)}},insertSearchWidget:function(a,b){var c=this;c.registerWidget(a,b),c.$searchGroup.append(b.element)},_initFiltersGroup:function(a){var c=this;a.forEach(function(a){var d,e=a.name,f=a.type;if(a.checked=a.checked||b[e],"radio"==f)d=new m(a);else{if("checkbox"!=f)return seajs.log("过滤组type错误："+f,"error"),void 0;d=new n(a)}c.registerWidget(e,d),c.$filterGroup.append(d.element)})},_initDataSource:function(){var a=this,b=this.get("url"),d=this.get("urlIds"),f=this.dataSource=new e({source:function(e,f){c.extend(!0,e,a.get("queryParams")),c.eduAjax({url:b,ids:d,rest:"get",data:e,done:function(a){f(a)}})}});f.on("data",this._setResult.bind(a))},getSearchData:function(){var a={},b=this.formWidgets;return Object.keys(b).forEach(function(d){c.extend(a,b[d].getValue())}),a},_setResult:function(a){this.renderTable(a.collection),this.renderPagination(a)},renderTable:function(a){var b=this,d=b.get("tableCfg"),e=d.cols,f=c.getDocFragment();a.length?a.forEach(function(a){new o({parentNode:f,tableCfg:d,itemData:a})}):f.append('<tr><td colspan="'+(e.length+1)+'"><div class="">查询无结果</div></td></tr>'),this.$("tbody").empty().append(f)},renderPagination:function(a){var b=this.get("hasPaginator");b&&this.paginator.set("renderData",{totalCount:a.totalCount,currentPage:a.currentPage,totalPages:a.totalPages})},doSearch:function(a){a=a||1;var b=this.getSearchData();b.currentPage=a,this.recordSearchData(b),this.dataSource.getData(b)},recordSearchData:function(a){var c=s();b=t[c]=a},fetch:function(){this.doSearch(b.currentPage||1)}});return u}),define("value/datagrid/1.0.0/data-grid-text.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b){var c,d="";return d+=k((c=b.key,typeof c===j?c.apply(a):c))+'="'+k(typeof a===j?a.apply(a):a)+'"'}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var g in a.helpers)c[g]=c[g]||a.helpers[g];e=e||{};var h,i="",j="function",k=this.escapeExpression,l=this;return i+='<div class="search-item">\r\n    <input type="text" class="form-control keywords" name="',(h=c.name)?h=h.call(b,{hash:{},data:e}):(h=b.name,h=typeof h===j?h.apply(b):h),i+=k(h)+'" value="',(h=c.value)?h=h.call(b,{hash:{},data:e}):(h=b.value,h=typeof h===j?h.apply(b):h),i+=k(h)+'" ',h=c.each.call(b,b.nodeData,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+=" />\r\n</div>"})}),define("value/datagrid/1.0.0/data-grid-select.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b,d){var e,f,g,h="";return h+='\r\n            <option value="',(e=c.value)?e=e.call(a,{hash:{},data:b}):(e=a.value,e=typeof e===j?e.apply(a):e),h+=k(e)+'" ',g={hash:{},data:b},h+=k((e=c.dealSelected,e?e.call(a,a.value,d.selected,g):l.call(a,"dealSelected",a.value,d.selected,g)))+">",(f=c.label)?f=f.call(a,{hash:{},data:b}):(f=a.label,f=typeof f===j?f.apply(a):f),h+=k(f)+"</option>\r\n        "}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var g in a.helpers)c[g]=c[g]||a.helpers[g];e=e||{};var h,i="",j="function",k=this.escapeExpression,l=c.helperMissing,m=this;return i+='<div class="search-item">\r\n    <select class="form-control">\r\n        ',h=c.each.call(b,b.dataList,{hash:{},inverse:m.noop,fn:m.programWithDepth(1,f,e,b),data:e}),(h||0===h)&&(i+=h),i+="\r\n    </select>\r\n</div>"})}),define("value/datagrid/1.0.0/data-grid-buttons.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\r\n        <button type="button" class="btn btn-',(d=c.type)?d=d.call(a,{hash:{},data:b}):(d=a.type,d=typeof d===j?d.apply(a):d),e+=k(d)+' search-btn" data-btnkey="',(d=c.btnkey)?d=d.call(a,{hash:{},data:b}):(d=a.btnkey,d=typeof d===j?d.apply(a):d),e+=k(d)+'">',(d=c.text)?d=d.call(a,{hash:{},data:b}):(d=a.text,d=typeof d===j?d.apply(a):d),e+=k(d)+"</button>\r\n    "}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var g in a.helpers)c[g]=c[g]||a.helpers[g];e=e||{};var h,i="",j="function",k=this.escapeExpression,l=this;return i+='<div class="search-item">\r\n    ',h=c.each.call(b,b.btns,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+="\r\n</div>\r\n"})}),define("value/datagrid/1.0.0/grid-item/grid-item",["$","gallery/handlebars/1.0.2/runtime","value/base/1.0.0/base","arale/templatable/0.9.2/templatable","gallery/handlebars/1.0.2/handlebars","arale/widget/1.1.1/widget","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events"],function(a){"use strict";var b=a("$"),c=a("gallery/handlebars/1.0.2/runtime"),d=a("value/base/1.0.0/base"),e=a("value/datagrid/1.0.0/grid-item/grid-item.handlebars"),f={btnText:"button",type:"default",size:"xs",action:function(){seajs.log("按钮事件未指定","warn")}},g=d.extend({attrs:{template:e,model:{},itemData:{},tableCfg:{}},btnMap:{},events:{"click button,.dropdown-menu a":function(a){var c=this,d=b(a.currentTarget),e=d.data("btnkey"),f=this.get("itemData"),g=c.btnMap,h=g[e];h&&h.action&&h.action.call(c,f,d)}},initAttrs:function(a,b){g.superclass.initAttrs.call(this,a,b),this.setBtnMap(),this.setModel()},setModel:function(){var a=this.get("model");a.tableCfg=this.get("tableCfg"),a.itemData=this.get("itemData"),a.btnList=this.getGridBtns()},setBtnMap:function(){function a(a){a.btnTextRet=b.result(a.btnText,c,c.get("itemData"))}var c=this,d=this.get("tableCfg");if(d.operators){var e=d.operators.btnMap;Object.keys(e).forEach(function(c){var d=e[c]=b.extend({},f,e[c]);a(d);var g=d.dropdownItems;g&&g.length&&g.forEach(a)}),this.btnMap=d.operators.btnMap}},updateSelf:function(){this.setBtnMap();var a=this.get("model");a.btnList=this.getGridBtns(),this.renderPartial()},getGridBtns:function(){var a=this.get("tableCfg"),b=a.operators;if(b){var c=this.btnMap,d=b.btnsFilter,e=d.call(this.get("itemData")),f=e.map(function(a){var b=c[a];return b.btnkey=a,b});return f}},templateHelpers:{renderItemData:function(a,b){function d(b,c){return c?c(b,a):b}var e="",f=b.cols;return f.forEach(function(b){var c=["<td>",d(a[b.property],b.format),"</td>"];e+=c.join("")}),new c.SafeString(e)}}});return g}),define("value/datagrid/1.0.0/grid-item/grid-item.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b,d){var e,f="";return f+="\n        <td>\n            ",e=c.each.call(a,d.btnList,{hash:{},inverse:r.noop,fn:r.program(2,g,b),data:b}),(e||0===e)&&(f+=e),f+="\n        </td>\n    "}function g(a,b){var d,e="";return e+="\n                ",d=c["if"].call(a,a.dropdown,{hash:{},inverse:r.program(6,j,b),fn:r.program(3,h,b),data:b}),(d||0===d)&&(e+=d),e+="\n            "}function h(a,b){var d,e="";return e+='\n                    <div class="btn-group">\n                        <a href="javascript:void(0)" class="btn btn-',(d=c.type)?d=d.call(a,{hash:{},data:b}):(d=a.type,d=typeof d===p?d.apply(a):d),e+=q(d)+" btn-",(d=c.size)?d=d.call(a,{hash:{},data:b}):(d=a.size,d=typeof d===p?d.apply(a):d),e+=q(d)+' dropdown-toggle" data-toggle="dropdown">\n                            ',(d=c.btnTextRet)?d=d.call(a,{hash:{},data:b}):(d=a.btnTextRet,d=typeof d===p?d.apply(a):d),e+=q(d)+'\n                            <span class="caret"></span>\n                        </a>\n                        <ul class="dropdown-menu">\n\n                        ',d=c.each.call(a,a.dropdownItems,{hash:{},inverse:r.noop,fn:r.program(4,i,b),data:b}),(d||0===d)&&(e+=d),e+="\n                        </ul>\n                    </div>\n                "}function i(a,b){var d,e="";return e+='\n                            <li>\n                                <a href="javascript:void(0)" data-btnkey="',(d=c.btnkey)?d=d.call(a,{hash:{},data:b}):(d=a.btnkey,d=typeof d===p?d.apply(a):d),e+=q(d)+'">',(d=c.btnTextRet)?d=d.call(a,{hash:{},data:b}):(d=a.btnTextRet,d=typeof d===p?d.apply(a):d),(d||0===d)&&(e+=d),e+="</a>\n                            </li>\n                        "}function j(a,b){var d,e="";return e+='\n                <button type="button" class="btn btn-',(d=c.size)?d=d.call(a,{hash:{},data:b}):(d=a.size,d=typeof d===p?d.apply(a):d),e+=q(d)+" btn-",(d=c.type)?d=d.call(a,{hash:{},data:b}):(d=a.type,d=typeof d===p?d.apply(a):d),e+=q(d)+'" data-btnkey="',(d=c.btnkey)?d=d.call(a,{hash:{},data:b}):(d=a.btnkey,d=typeof d===p?d.apply(a):d),e+=q(d)+'" >',(d=c.btnTextRet)?d=d.call(a,{hash:{},data:b}):(d=a.btnTextRet,d=typeof d===p?d.apply(a):d),e+=q(d)+"</button>&nbsp;\n                "}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var k in a.helpers)c[k]=c[k]||a.helpers[k];e=e||{};var l,m,n,o="",p="function",q=this.escapeExpression,r=this,s=c.helperMissing;return o+="<tr>\n    ",n={hash:{},data:e},o+=q((l=c.renderItemData,l?l.call(b,b.itemData,b.tableCfg,n):s.call(b,"renderItemData",b.itemData,b.tableCfg,n)))+"\n\n    ",m=c["if"].call(b,(l=b.tableCfg,null==l||l===!1?l:l.operators),{hash:{},inverse:r.noop,fn:r.programWithDepth(1,f,e,b),data:e}),(m||0===m)&&(o+=m),o+="\n</tr>\n"})}),define("value/datagrid/1.0.0/data-grid.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b){var d,e,f="";return f+='\r\n        <div class="top-operation">\r\n            \r\n            ',e=c["if"].call(a,(d=a.topOperation,null==d||d===!1?d:d.btnsGroup),{hash:{},inverse:s.noop,fn:s.program(2,g,b),data:b}),(e||0===e)&&(f+=e),f+="\r\n            \r\n            ",e=c["if"].call(a,(d=a.topOperation,null==d||d===!1?d:d.searchGroup),{hash:{},inverse:s.noop,fn:s.program(5,i,b),data:b}),(e||0===e)&&(f+=e),f+="\r\n            \r\n            ",e=c["if"].call(a,(d=a.topOperation,null==d||d===!1?d:d.filtersGroup),{hash:{},inverse:s.noop,fn:s.program(7,j,b),data:b}),(e||0===e)&&(f+=e),f+="\r\n        </div>\r\n    "}function g(a,b){var d,e,f="";return f+='\r\n                <div class="btn-group pull-right">\r\n                    ',e=c.each.call(a,(d=a.topOperation,null==d||d===!1?d:d.btnsGroup),{hash:{},inverse:s.noop,fn:s.program(3,h,b),data:b}),(e||0===e)&&(f+=e),f+="\r\n                </div>\r\n            "}function h(a,b){var d,e="";return e+='\r\n                        <a class="btn btn-default" href="',(d=c.href)?d=d.call(a,{hash:{},data:b}):(d=a.href,d=typeof d===q?d.apply(a):d),e+=r(d)+'" data-btnkey="',(d=c.btnkey)?d=d.call(a,{hash:{},data:b}):(d=a.btnkey,d=typeof d===q?d.apply(a):d),e+=r(d)+'">',(d=c.text)?d=d.call(a,{hash:{},data:b}):(d=a.text,d=typeof d===q?d.apply(a):d),e+=r(d)+"</a>\r\n                    "}function i(){return'\r\n                <div class="search-group clearfix">\r\n                </div>\r\n            '}function j(){return'\r\n                <div class="filter-group form-horizontal">\r\n                </div>\r\n            '}function k(a,b){var d,e="";return e+='\r\n                    <th width="',(d=c.width)?d=d.call(a,{hash:{},data:b}):(d=a.width,d=typeof d===q?d.apply(a):d),e+=r(d)+'">',(d=c.text)?d=d.call(a,{hash:{},data:b}):(d=a.text,d=typeof d===q?d.apply(a):d),e+=r(d)+"</th>\r\n                "}function l(a){var b,c="";return c+='\r\n                    <th width="'+r((b=a.tableCfg,b=null==b||b===!1?b:b.operators,b=null==b||b===!1?b:b.col,b=null==b||b===!1?b:b.width,typeof b===q?b.apply(a):b))+'">'+r((b=a.tableCfg,b=null==b||b===!1?b:b.operators,b=null==b||b===!1?b:b.col,b=null==b||b===!1?b:b.text,typeof b===q?b.apply(a):b))+"</th>\r\n                "}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var m in a.helpers)c[m]=c[m]||a.helpers[m];e=e||{};var n,o,p="",q="function",r=this.escapeExpression,s=this;return p+='<div class="data-grid">\r\n    ',n=c["if"].call(b,b.topOperation,{hash:{},inverse:s.noop,fn:s.program(1,f,e),data:e}),(n||0===n)&&(p+=n),p+='\r\n    <div class="datagrid-result mrgb10">\r\n        <table class="table table-bordered table-hover">\r\n            <thead>\r\n            <tr>\r\n                ',o=c.each.call(b,(n=b.tableCfg,null==n||n===!1?n:n.cols),{hash:{},inverse:s.noop,fn:s.program(9,k,e),data:e}),(o||0===o)&&(p+=o),p+="\r\n                ",o=c["if"].call(b,(n=b.tableCfg,null==n||n===!1?n:n.operators),{hash:{},inverse:s.noop,fn:s.program(11,l,e),data:e}),(o||0===o)&&(p+=o),p+='\r\n            </tr>\r\n            </thead>\r\n\r\n            <tbody>\r\n            </tbody>\r\n\r\n        </table>\r\n        <div class="paginator-wrapper pull-right"></div>\r\n    </div>\r\n</div>'})});
