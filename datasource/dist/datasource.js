define("value/datasource/1.0.0/datasource",["$","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events"],function(a,b,c){"use strict";function d(a){return"[object String]"===Object.prototype.toString.call(a)}function e(a){return a.replace(/^([a-z])/,function(a,b){return b.toUpperCase()})}var f=a("$"),g=a("arale/base/1.1.1/base"),h=g.extend({attrs:{source:null,type:"array"},initialize:function(a){h.superclass.initialize.call(this,a),this.id=0,this.callbacks=[];var b=this.get("source");if(d(b))this.set("type","url");else if(f.isArray(b))this.set("type","array");else if(f.isPlainObject(b))this.set("type","object");else{if(!f.isFunction(b))throw new Error("Source Type Error");this.set("type","function")}},getData:function(a){return this["_get"+e(this.get("type")||"")+"Data"](a)},abort:function(){this.callbacks=[]},_done:function(a){this.trigger("data",a)},_getUrlData:function(a){var b,c=this,d={query:a?encodeURIComponent(a):"",timestamp:(new Date).getTime()},e=this.get("source").replace(/\{\{(.*?)\}\}/g,function(a,b){return d[b]}),g="callback_"+this.id++;this.callbacks.push(g),b=/^(https?:\/\/)/.test(e)?{dataType:"jsonp"}:{dataType:"json"},f.ajax(e,b).success(function(a){f.inArray(g,c.callbacks)>-1&&(delete c.callbacks[g],c._done(a))}).error(function(){f.inArray(g,c.callbacks)>-1&&(delete c.callbacks[g],c._done({}))})},_getArrayData:function(){var a=this.get("source");return this._done(a),a},_getObjectData:function(){var a=this.get("source");return this._done(a),a},_getFunctionData:function(a){function b(a){c._done(a)}var c=this,d=this.get("source"),e=d.call(this,a,b);e&&this._done(e)}});c.exports=h});
